<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bloco de Notas - Tragetória</title>
  <link href=".\css\notas.css" rel="stylesheet">
  <link href=".\css\geral.css" rel="stylesheet">
</head>
<body>
  <aside class="sidebar">
    <h2 class="logo">Tragetória</h2>
    <nav>
      <a href="/home">Gráficos</a>
      <a href="/notas">Notas</a>
      <a href="/aboutUs">Sobre</a>
    </nav>
    <a href="/"><button class="btn-sair">Sair</button></a>
  </aside>

  <main class="content">
    <header class="notas-header">
      <h1>Bloco de Notas</h1>
      <button class="btn-adicionar">+ Nova Nota</button>
    </header>

    <div class="nova-nota-form">
      
        <input type="text" id="tituloNota" placeholder="Título da nota">
        <input id="conteudoNota" type="text" placeholder="Escreva sua nota..."></input>
        <input type="color" id="corNota" value="#2f382f">
        <button id="criarNotaBtn" type="submit" value="Criar nota">Criar Nota</button>
      
      
    </div>

    <section class="notas-container">
      <div class="nota">
        <h3>Planejamento da Semana</h3>
        <p>Revisar os dados de produção e organizar as metas para a próxima colheita.</p>
      </div>

      <div class="nota">
        <h3>Custos de Transporte</h3>
        <p>Analisar se há rotas mais baratas para envio das cargas.</p>
      </div>

      <div class="nota">
        <h3>Contato com Fornecedor</h3>
        <p>Mandar mensagem para confirmar entrega de insumos até sexta.</p>
      </div>
    </section>
  </main>

   <script>
    // Seleciona elementos
    const btnAdicionar = document.querySelector('.btn-adicionar');
    const formNovaNota = document.querySelector('.nova-nota-form');
    const criarNotaBtn = document.getElementById('criarNotaBtn');
    const notasContainer = document.querySelector('.notas-container');

    
    const USER_ID = localStorage.getItem('userId');
    if (!USER_ID) {
      
      window.location.href = '/';
    }

    criarNotaBtn.type = 'button';

    btnAdicionar.addEventListener('click', () => {
      formNovaNota.style.display = formNovaNota.style.display === 'flex' ? 'none' : 'flex';
    });

    // Função para renderizar nota no DOM
    function renderNota(nota) {
      const div = document.createElement('div');
      div.classList.add('nota');
      div.style.backgroundColor = nota.color || '#2f382f';
      div.innerHTML = `<h3>${nota.title}</h3><p>${nota.content}</p>`;
      notasContainer.appendChild(div);
    }

    // Carrega notas do servidor para o usuário
    async function loadNotas() {
      try {
        const res = await fetch(`/notas/${USER_ID}`);
        if (!res.ok) return;
        const notas = await res.json();
        notasContainer.innerHTML = '';
        notas.forEach(n => renderNota({ title: n.title, content: n.content, color: n.color }));
      } catch (err) {
        console.error('Erro ao carregar notas', err);
      }
    }
    loadNotas();

    // Cria nova nota e envia para o servidor
    criarNotaBtn.addEventListener('click', async () => {
      const title = document.getElementById('tituloNota').value.trim();
      const content = document.getElementById('conteudoNota').value.trim();
      const color = document.getElementById('corNota').value;

      if (!title || !content) {
        alert('Preencha título e conteúdo da nota!');
        return;
      }

      try {
        const res = await fetch('/notas', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ title, content, color, user_id: USER_ID })
        });
        const body = await res.json();
        if (res.ok && body.success) {
          renderNota({ title, content, color });
          document.getElementById('tituloNota').value = '';
          document.getElementById('conteudoNota').value = '';
          document.getElementById('corNota').value = '#2f382f';
          formNovaNota.style.display = 'none';
        } else {
          alert('Erro ao salvar nota');
          console.error(body);
        }
      } catch (err) {
        console.error('Erro na requisição', err);
        alert('Erro ao salvar nota');
      }
    });
  </script>
  
</body>
</html>
